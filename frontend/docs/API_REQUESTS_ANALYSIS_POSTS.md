# üìä –û—Ç—á—ë—Ç: –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Posts.tsx

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2024  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∫ API –¥–µ–ª–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ–¥–∏–Ω–æ–∂–¥—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ—Ç–∫–∏/–º–∞—Ä—à—Ä—É—Ç–∞, –∞ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

## üîç –û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞

### –ü—É—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç–∞–≤–∏—Ç –º–µ—Ç–∫–∏ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ç—Ä–æ–∏—Ç –º–∞—Ä—à—Ä—É—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ø–æ—Å—Ç ‚Üí –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∫—É/–º–∞—Ä—à—Ä—É—Ç

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- ‚úÖ –ó–∞–ø—Ä–æ—Å –∫ API —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ç–∫–∏/–º–∞—Ä—à—Ä—É—Ç–∞
- ‚úÖ –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (post.marker_id, post.route_id)
- ‚úÖ –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üìç –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ API

### 1. **MiniMapMarker.tsx** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PostCard)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/Posts/MiniMapMarker.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 154-231: useEffect –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–∞
useEffect(() => {
  const loadMarkerData = async () => {
    // 1) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º (favorites.favoritePlaces)
    // 2) –ü—Ä–æ–≤–µ—Ä–∫–∞ draft (localStorage)
    // 3) –ó–∞–ø—Ä–æ—Å –∫ API: getMarkerById(markerId)
  };
  loadMarkerData();
}, [markerId]); // ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ markerId
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ó–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `markerId`**
- ‚úÖ **–ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ API**
- ‚úÖ **–ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ draft –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ API**
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** `favorites` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏, –Ω–æ –Ω–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
  - –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ favorites
  - –ù–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –¢–µ–∫—É—â–∏–π –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∞ 231):
}, [markerId]); // –£–±–∏—Ä–∞–µ–º favorites –∏ auth –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

// –ü—Ä–æ–±–ª–µ–º–∞: favorites –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è, –Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è
// –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É favorites –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useMemo
```

---

### 2. **MiniMapRoute.tsx** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PostCard)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/Posts/MiniMapRoute.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 144-189: useEffect –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–∞
useEffect(() => {
  const loadRouteData = async () => {
    // 1) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º (favorites.favoriteRoutes)
    // 2) –ó–∞–ø—Ä–æ—Å –∫ API: getRouteById(routeId)
  };
  loadRouteData();
}, [routeId]); // ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ routeId
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ó–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `routeId`**
- ‚úÖ **–ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –∫ API**
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** `favorites` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏, –Ω–æ –Ω–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ MiniMapMarker)

---

### 3. **PostMap.tsx** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ MiniMapMarker, InteractivePostView)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/Maps/PostMap.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 428-458: useEffect –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–∞
useEffect(() => {
  if (!selectedMarkerIdForPopup) {
    setLoadedMarkerData(null);
    return;
  }
  
  // ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞: –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  if (lastClickedMarkerDataRef.current && 
      lastClickedMarkerDataRef.current.id === selectedMarkerIdForPopup &&
      lastClickedMarkerDataRef.current.photo_urls &&
      lastClickedMarkerDataRef.current.photo_urls.length > 0) {
    setLoadedMarkerData(lastClickedMarkerDataRef.current);
    return; // ‚úÖ –ù–µ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  }
  
  // ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
  if (!isLoadingMarkerRef.current) {
    isLoadingMarkerRef.current = true;
    getMarkerById(selectedMarkerIdForPopup)
      .then(fullMarkerData => {
        if (fullMarkerData && fullMarkerData.id === selectedMarkerIdForPopup) {
          setLoadedMarkerData(fullMarkerData);
        }
        isLoadingMarkerRef.current = false;
      })
      .catch(() => {
        isLoadingMarkerRef.current = false;
      });
  }
}, [selectedMarkerIdForPopup]);
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ó–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `selectedMarkerIdForPopup`**
- ‚úÖ **–ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `isLoadingMarkerRef.current` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
- ‚úÖ **–ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `lastClickedMarkerDataRef.current` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **–û—Ç–ª–∏—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è!**

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –°—Ç—Ä–æ–∫–∞ 585-597: –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ ORS API —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ geometry –ø—Ä—è–º–∞—è –ª–∏–Ω–∏—è
- –°—Ç—Ä–æ–∫–∞ 550-817: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É (–±–µ–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API, —Ç–æ–ª—å–∫–æ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞)

---

### 4. **PostCard.tsx** (–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/Posts/PostCard.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
- ‚ùå **–ù–µ—Ç –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `MiniMapMarker` –∏ `MiniMapRoute` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- ‚úÖ –î–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ `post.marker_id` –∏ `post.route_id` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø—Ä–æ–ø—Å–æ–≤ `post`**

---

### 5. **InteractivePostView.tsx** (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å—Ç–∞)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/components/Posts/InteractivePostView.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
- ‚ùå **–ù–µ—Ç –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `post.attached_snapshot` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `favorites` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 353-398)

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**
- ‚úÖ **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è**

---

### 6. **Posts.tsx** (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `frontend/src/pages/Posts.tsx`

**–ó–∞–ø—Ä–æ—Å—ã –∫ API:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 70-87: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤
useEffect(() => {
  const loadPosts = async () => {
    const response = await listPosts({ 
      limit: 50,
      content_type: contentFilter === 'all' ? 'all' : contentFilter
    });
    setPosts(response.data);
  };
  loadPosts();
}, [contentFilter]); // ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ contentFilter
```

**–ê–Ω–∞–ª–∏–∑:**
- ‚úÖ **–ó–∞–ø—Ä–æ—Å –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `contentFilter`**
- ‚úÖ **–≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤)**

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ favorites

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `MiniMapMarker.tsx`, `MiniMapRoute.tsx`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- `favorites` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ `useEffect`, –Ω–æ –Ω–µ –≤–∫–ª—é—á—ë–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ï—Å–ª–∏ `favorites` –∏–∑–º–µ–Ω–∏—Ç—Å—è, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–¥:**
```typescript
// MiniMapMarker.tsx, —Å—Ç—Ä–æ–∫–∞ 231
}, [markerId]); // –£–±–∏—Ä–∞–µ–º favorites –∏ auth –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

// MiniMapRoute.tsx, —Å—Ç—Ä–æ–∫–∞ 189
}, [routeId]); // –£–±–∏—Ä–∞–µ–º favorites –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

**–í–ª–∏—è–Ω–∏–µ:**
- ‚ö†Ô∏è –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ favorites

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å favorites –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏)
}, [markerId, favorites?.favoritePlaces]);

// –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useMemo –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ favorites
const favoriteMarker = useMemo(() => {
  return favorites?.favoritePlaces?.find(place => place.id === markerId);
}, [markerId, favorites?.favoritePlaces]);

// –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ref –¥–ª—è favorites (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `MiniMapMarker.tsx`, `MiniMapRoute.tsx`

**–û–ø–∏—Å–∞–Ω–∏–µ:**
- –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ API
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ï—Å–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –º–∞—Ä–∫–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å—Ç–∞—Ö, –±—É–¥–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// –ï—Å–ª–∏ 10 –ø–æ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ marker_id
// –ë—É–¥–µ—Ç 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ /api/markers/{id}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React Query –∏–ª–∏ SWR –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à –≤ Context

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. PostMap.tsx ‚Äî –æ—Ç–ª–∏—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `isLoadingMarkerRef.current` ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `lastClickedMarkerDataRef.current` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `selectedMarkerIdForPopup` ‚Äî –∑–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø—Ä–æ—Å –∫ API –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞.

---

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**PostCard.tsx:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `post.marker_id` –∏ `post.route_id` –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ù–µ –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –Ω–∞–ø—Ä—è–º—É—é

**InteractivePostView.tsx:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `post.attached_snapshot` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `favorites` –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

---

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ useEffect

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ `MiniMapMarker`: `[markerId]` ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID
- ‚úÖ `MiniMapRoute`: `[routeId]` ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID
- ‚úÖ `PostMap`: `[selectedMarkerIdForPopup]` ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID
- ‚úÖ `Posts`: `[contentFilter]` ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤ (10 –ø–æ—Å—Ç–æ–≤, 5 —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏, 3 —Å –º–∞—Ä—à—Ä—É—Ç–∞–º–∏)

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/api/markers/{id}` (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π marker_id)
- 3 –∑–∞–ø—Ä–æ—Å–∞ –∫ `/api/routes/{id}` (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π route_id)

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚ö†Ô∏è 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/api/markers/{id}` (–µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä—ã —Ä–∞–∑–Ω—ã–µ)
- ‚ö†Ô∏è 3 –∑–∞–ø—Ä–æ—Å–∞ –∫ `/api/routes/{id}` (–µ—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç—ã —Ä–∞–∑–Ω—ã–µ)
- ‚ö†Ô∏è **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –º–∞—Ä–∫–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Å—Ç–∞—Ö, –±—É–¥–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä –≤ PostMap

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- 1 –∑–∞–ø—Ä–æ—Å –∫ `/api/markers/{id}` (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ `lastClickedMarkerDataRef`)

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ 1 –∑–∞–ø—Ä–æ—Å –∫ `/api/markers/{id}` (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `lastClickedMarkerDataRef` –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ ORS

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ó–∞–ø—Ä–æ—Å –∫ ORS —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ geometry ‚Äî –ø—Ä—è–º–∞—è –ª–∏–Ω–∏—è

**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚úÖ –ó–∞–ø—Ä–æ—Å –∫ ORS —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `isStraightLine(renderableGeometry) === true`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é `route_data.geometry` –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å –∏ –Ω–µ –ø—Ä—è–º–∞—è

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

1. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**
   ```typescript
   // –°–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫—ç—à
   const markerCache = new Map<string, { data: MarkerData, timestamp: number }>();
   const CACHE_TTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
   
   // –í MiniMapMarker.tsx
   const cached = markerCache.get(markerId);
   if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
     setMarkerData(cached.data);
     return;
   }
   ```

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ favorites**
   ```typescript
   // MiniMapMarker.tsx
   const favoriteMarker = useMemo(() => {
     return favorites?.favoritePlaces?.find(place => place.id === markerId);
   }, [markerId, favorites?.favoritePlaces]);
   ```

---

### –í–∞–∂–Ω—ã–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

3. **–î–æ–±–∞–≤–∏—Ç—å React Query –∏–ª–∏ SWR**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   - –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   ```typescript
   export default React.memo(MiniMapMarker, (prev, next) => {
     return prev.markerId === next.markerId;
   });
   ```

---

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (—É–ª—É—á—à–µ–Ω–∏—è)

5. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫–µ–ª–µ—Ç–æ–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
   - –£–ª—É—á—à–∏—Ç—å UX

6. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
   - Retry –º–µ—Ö–∞–Ω–∏–∑–º

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –∫ API –¥–µ–ª–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ID (markerId, routeId)
- ‚úÖ PostMap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
- ‚úÖ –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ useEffect

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
- ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- ‚ö†Ô∏è –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ favorites (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚ö†Ô∏è –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–∞—Ä–∫–µ—Ä–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **7/10**

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –µ—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ª–∏—à–Ω–∏–º –∑–∞–ø—Ä–æ—Å–∞–º –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤/–º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024

