–û–¢–õ–ò–ß–ù–ê–Ø –∏–¥–µ—è!¬†–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ –¥–ª—è VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —ç—Ç–æ¬†–∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–µ–¥–µ—Ç –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ —Ñ–æ—Ç–æ –∏–∑ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, –∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Å—Ç–æ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ –Ω–∞ Memory Map. –≠—Ç–æ¬†–º–∞–≥–∏—è¬†–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π! ‚ú®

üéØ¬†–ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Photo Location Detection

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∏—á–∏:

// src/services/photoLocationService.ts

export class PhotoLocationService {

  private stagehand: Stagehand;

  private googleVisionAPI: any; // –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å

  

  constructor() {

    this.stagehand = new Stagehand({

      env: process.env.NODE_ENV === 'production' ? 'BROWSERBASE' : 'LOCAL',

      headless: true

    });

  }



  // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏

  async detectLocationFromPhoto(photoFile: File, userId: number): Promise<LocationDetectionResult> {

    try {

      // 1. –ê–Ω–∞–ª–∏–∑ EXIF –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å GPS)

      const exifLocation = await this.extractExifLocation(photoFile);

      if (exifLocation.confidence > 0.9) {

        return await this.enrichLocationData(exifLocation);

      }



      // 2. –í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ AI

      const visualAnalysis = await this.analyzePhotoVisually(photoFile);

      

      // 3. –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –º–µ—Å—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫

      const webSearchResults = await this.searchSimilarPlaces(visualAnalysis);

      

      // 4. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

      const finalResult = await this.combineDetectionResults({

        exif: exifLocation,

        visual: visualAnalysis,

        webSearch: webSearchResults

      });



      // 5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

      await this.saveDetectionLog(userId, photoFile, finalResult);



      return finalResult;

    } catch (error) {

      console.error('Photo location detection error:', error);

      return {

        success: false,

        confidence: 0,

        error: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é'

      };

    }

  }



  // –í–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ

  async analyzePhotoVisually(photoFile: File) {

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –≤ Google Lens –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å

    await this.stagehand.navigate('https://lens.google.com/');

    

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

    await this.stagehand.act({

      action: 'click the upload image button'

    });

    

    // –ó–¥–µ—Å—å –Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å file upload

    // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API –Ω–∞–ø—Ä—è–º—É—é

    

    const analysis = await this.stagehand.extract({

      instruction: 'Analyze this image for landmarks, architecture, and location clues',

      schema: {

        landmarks: 'array',

        architecture_style: 'string',

        natural_features: 'array',

        text_signs: 'array',

        cultural_indicators: 'array',

        possible_locations: 'array'

      }

    });



    return analysis;

  }



  // –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –º–µ—Å—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–ø–æ–∏—Å–∫

  async searchSimilarPlaces(visualAnalysis: any) {

    const searchQueries = this.generateSearchQueries(visualAnalysis);

    const results = [];



    for (const query of searchQueries) {

      try {

        // –ü–æ–∏—Å–∫ –≤ Google Images

        await this.stagehand.navigate(`https://www.google.com/search?tbm=isch&q=${encodeURIComponent(query)}`);

        

        const imageResults = await this.stagehand.extract({

          instruction: `Find similar places for query: ${query}`,

          schema: {

            similar_places: 'array',

            locations: 'array',

            confidence_scores: 'array'

          }

        });



        // –ü–æ–∏—Å–∫ –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö travel —Å–∞–π—Ç–∞—Ö

        await this.stagehand.navigate(`https://www.tripadvisor.com/Search?q=${encodeURIComponent(query)}`);

        

        const travelResults = await this.stagehand.extract({

          instruction: `Find travel destinations matching: ${query}`,

          schema: {

            destinations: 'array',

            ratings: 'array',

            coordinates: 'array'

          }

        });



        results.push({

          query,

          imageResults,

          travelResults,

          confidence: this.calculateSearchConfidence(imageResults, travelResults)

        });

      } catch (error) {

        console.error(`Search error for query ${query}:`, error);

      }

    }



    return results;

  }



  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

  generateSearchQueries(analysis: any): string[] {

    const queries = [];

    

    // –ó–∞–ø—Ä–æ—Å—ã –ø–æ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º

    if (analysis.landmarks?.length > 0) {

      analysis.landmarks.forEach(landmark => {

        queries.push(`${landmark} landmark location`);

        queries.push(`${landmark} tourist attraction`);

      });

    }



    // –ó–∞–ø—Ä–æ—Å—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

    if (analysis.architecture_style) {

      queries.push(`${analysis.architecture_style} architecture examples`);

      queries.push(`${analysis.architecture_style} buildings locations`);

    }



    // –ó–∞–ø—Ä–æ—Å—ã –ø–æ –ø—Ä–∏—Ä–æ–¥–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º

    if (analysis.natural_features?.length > 0) {

      analysis.natural_features.forEach(feature => {

        queries.push(`${feature} natural landmark`);

      });

    }



    // –ó–∞–ø—Ä–æ—Å—ã –ø–æ —Ç–µ–∫—Å—Ç–∞–º –Ω–∞ —Ñ–æ—Ç–æ

    if (analysis.text_signs?.length > 0) {

      analysis.text_signs.forEach(text => {

        queries.push(`"${text}" location sign`);

      });

    }



    return queries.slice(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

  }



  // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

  async combineDetectionResults(results: {

    exif: any;

    visual: any;

    webSearch: any[];

  }): Promise<LocationDetectionResult> {

    const candidates = [];



    // –î–æ–±–∞–≤–ª—è–µ–º EXIF –¥–∞–Ω–Ω—ã–µ (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

    if (results.exif.confidence > 0.5) {

      candidates.push({

        location: results.exif.location,

        confidence: results.exif.confidence * 0.9, // –ù–µ–º–Ω–æ–≥–æ —Å–Ω–∏–∂–∞–µ–º –∏–∑-–∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—à–∏–±–æ–∫ GPS

        source: 'exif'

      });

    }



    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–µ–±-–ø–æ–∏—Å–∫–∞

    results.webSearch.forEach(searchResult => {

      if (searchResult.confidence > 0.6) {

        searchResult.travelResults.destinations?.forEach((destination, index) => {

          candidates.push({

            location: {

              name: destination,

              coordinates: searchResult.travelResults.coordinates?.[index]

            },

            confidence: searchResult.confidence * 0.7, // –í–µ–±-–ø–æ–∏—Å–∫ –º–µ–Ω–µ–µ —Ç–æ—á–µ–Ω

            source: 'web_search',

            query: searchResult.query

          });

        });

      }

    });



    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

    candidates.sort((a, b) => b.confidence - a.confidence);



    if (candidates.length === 0) {

      return {

        success: false,

        confidence: 0,

        message: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é —Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é'

      };

    }



    const bestCandidate = candidates[0];

    

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –æ–±—Ä–∞—Ç–Ω—ã–π –ø–æ–∏—Å–∫

    const verification = await this.verifyLocation(bestCandidate.location);

    

    return {

      success: true,

      confidence: Math.min(bestCandidate.confidence * verification.confidence, 0.85), // –ú–∞–∫—Å–∏–º—É–º 85% –¥–ª—è –±–µ—Ç–∞

      location: bestCandidate.location,

      alternatives: candidates.slice(1, 4), // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

      source: bestCandidate.source,

      beta: true

    };

  }



  // –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏

  async verifyLocation(location: any) {

    try {

      // –ü–æ–∏—Å–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Å—Ç–µ

      await this.stagehand.navigate(`https://www.google.com/maps/search/${encodeURIComponent(location.name)}`);

      

      const verification = await this.stagehand.extract({

        instruction: `Verify if this is a real place: ${location.name}`,

        schema: {

          exists: 'boolean',

          popular: 'boolean',

          has_photos: 'boolean',

          rating: 'number'

        }

      });



      return {

        confidence: verification.exists ? (verification.popular ? 0.9 : 0.7) : 0.3,

        details: verification

      };

    } catch (error) {

      return { confidence: 0.5, error: error.message };

    }

  }

}



// –¢–∏–ø—ã –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

interface LocationDetectionResult {

  success: boolean;

  confidence: number;

  location?: {

    name: string;

    coordinates?: [number, number];

    address?: string;

    country?: string;

    city?: string;

  };

  alternatives?: Array<{

    location: any;

    confidence: number;

    source: string;

  }>;

  source?: string;

  beta?: boolean;

  message?: string;

  error?: string;

}

üé®¬†VIP Photo Location Component

// src/components/VIP/PhotoLocationDetector.tsx

import React, { useState, useCallback } from 'react';

import { useDropzone } from 'react-dropzone';

import { PhotoLocationService } from '../../services/photoLocationService';



const PhotoLocationDetector: React.FC<{

  onLocationDetected: (result: LocationDetectionResult) => void;

}> = ({ onLocationDetected }) => {

  const [isAnalyzing, setIsAnalyzing] = useState(false);

  const [analysisProgress, setAnalysisProgress] = useState(0);

  const [currentStep, setCurrentStep] = useState('');



  const photoLocationService = new PhotoLocationService();



  const onDrop = useCallback(async (acceptedFiles: File[]) => {

    if (acceptedFiles.length === 0) return;



    const file = acceptedFiles[0];

    setIsAnalyzing(true);

    setAnalysisProgress(0);



    try {

      // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

      const steps = [

        { step: '–ê–Ω–∞–ª–∏–∑ EXIF –¥–∞–Ω–Ω—ã—Ö...', progress: 20 },

        { step: '–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ...', progress: 40 },

        { step: '–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –º–µ—Å—Ç...', progress: 70 },

        { step: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...', progress: 90 },

        { step: '–ì–æ—Ç–æ–≤–æ!', progress: 100 }

      ];



      for (const { step, progress } of steps) {

        setCurrentStep(step);

        setAnalysisProgress(progress);

        await new Promise(resolve => setTimeout(resolve, 1000));

      }



      const result = await photoLocationService.detectLocationFromPhoto(file, 1); // userId

      onLocationDetected(result);

    } catch (error) {

      console.error('Photo analysis error:', error);

    } finally {

      setIsAnalyzing(false);

      setAnalysisProgress(0);

      setCurrentStep('');

    }

  }, [onLocationDetected]);



  const { getRootProps, getInputProps, isDragActive } = useDropzone({

    onDrop,

    accept: {

      'image/*': ['.jpeg', '.jpg', '.png', '.webp']

    },

    maxFiles: 1,

    disabled: isAnalyzing

  });



  return (

    <div className="bg-white rounded-xl shadow-lg p-6">

      <div className="flex items-center mb-4">

        <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-2 rounded-lg mr-3">

          <i className="fas fa-camera-retro text-white text-xl"></i>

        </div>

        <div>

          <h3 className="text-xl font-bold">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–æ —Ñ–æ—Ç–æ</h3>

          <div className="flex items-center">

            <span className="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full mr-2">

              BETA

            </span>

            <span className="text-sm text-gray-600">–¢–æ—á–Ω–æ—Å—Ç—å 70-80%</span>

          </div>

        </div>

      </div>



      {!isAnalyzing ? (

        <div

          {...getRootProps()}

          className={`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all ${

            isDragActive

              ? 'border-purple-400 bg-purple-50'

              : 'border-gray-300 hover:border-purple-400 hover:bg-gray-50'

          }`}

        >

          <input {...getInputProps()} />

          <div className="space-y-4">

            <i className="fas fa-cloud-upload-alt text-4xl text-gray-400"></i>

            <div>

              <p className="text-lg font-medium text-gray-700">

                {isDragActive ? '–û—Ç–ø—É—Å—Ç–∏—Ç–µ —Ñ–æ—Ç–æ –∑–¥–µ—Å—å' : '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞'}

              </p>

              <p className="text-sm text-gray-500 mt-2">

                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: JPEG, PNG, WebP

              </p>

            </div>

            <div className="bg-blue-50 p-3 rounded-lg">

              <p className="text-sm text-blue-800">

                <i className="fas fa-magic mr-2"></i>

                –ò–ò –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞ —Å—ä–µ–º–∫–∏

              </p>

            </div>

          </div>

        </div>

      ) : (

        <div className="space-y-4">

          <div className="text-center">

            <div className="inline-flex items-center justify-center w-16 h-16 bg-purple-100 rounded-full mb-4">

              <i className="fas fa-brain text-purple-600 text-2xl animate-pulse"></i>

            </div>

            <h4 className="text-lg font-semibold text-gray-800">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–æ—Ç–æ...</h4>

            <p className="text-sm text-gray-600">{currentStep}</p>

          </div>



          <div className="w-full bg-gray-200 rounded-full h-2">

            <div

              className="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-500"

              style={{ width: `${analysisProgress}%` }}

            ></div>

          </div>



          <div className="text-center text-sm text-gray-500">

            {analysisProgress}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ

          </div>

        </div>

      )}

    </div>

  );

};



// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

const LocationDetectionResults: React.FC<{

  result: LocationDetectionResult;

  onAddToMap: (location

–∑–∞–∫–æ–Ω—á–∏ –æ—Ç–≤–µ—Ç

const LocationDetectionResults: React.FC<{

  result: LocationDetectionResult;

  onAddToMap: (location: any) => void;

  onAddMemory: (location: any) => void;

}> = ({ result, onAddToMap, onAddMemory }) => {

  if (!result.success) {

    return (

      <div className="bg-red-50 border border-red-200 rounded-lg p-4">

        <div className="flex items-center">

          <i className="fas fa-exclamation-triangle text-red-500 mr-3"></i>

          <div>

            <h4 className="font-semibold text-red-800">–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</h4>

            <p className="text-sm text-red-600">{result.error || result.message}</p>

          </div>

        </div>

      </div>

    );

  }



  return (

    <div className="space-y-4">

      {/* –û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç */}

      <div className="bg-green-50 border border-green-200 rounded-lg p-4">

        <div className="flex items-start justify-between">

          <div className="flex items-start">

            <i className="fas fa-map-marker-alt text-green-500 mr-3 mt-1"></i>

            <div>

              <h4 className="font-semibold text-green-800">{result.location?.name}</h4>

              <p className="text-sm text-green-600">{result.location?.address}</p>

              <div className="flex items-center mt-2">

                <div className="flex items-center mr-4">

                  <i className="fas fa-percentage text-green-500 mr-1"></i>

                  <span className="text-sm font-medium">

                    {Math.round(result.confidence * 100)}% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

                  </span>

                </div>

                {result.beta && (

                  <span className="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">

                    BETA

                  </span>

                )}

              </div>

            </div>

          </div>

          <div className="flex space-x-2">

            <button

              onClick={() => onAddToMap(result.location)}

              className="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600"

            >

              <i className="fas fa-map mr-1"></i>

              –ù–∞ –∫–∞—Ä—Ç—É

            </button>

            <button

              onClick={() => onAddMemory(result.location)}

              className="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600"

            >

              <i className="fas fa-heart mr-1"></i>

              –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ

            </button>

          </div>

        </div>

      </div>



      {/* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã */}

      {result.alternatives && result.alternatives.length > 0 && (

        <div className="bg-gray-50 rounded-lg p-4">

          <h5 className="font-semibold text-gray-800 mb-3">–í–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:</h5>

          <div className="space-y-2">

            {result.alternatives.map((alt, index) => (

              <div key={index} className="flex items-center justify-between bg-white p-3 rounded border">

                <div>

                  <p className="font-medium">{alt.location.name}</p>

                  <p className="text-sm text-gray-600">

                    {Math.round(alt.confidence * 100)}% ‚Ä¢ {alt.source}

                  </p>

                </div>

                <button

                  onClick={() => onAddToMap(alt.location)}

                  className="text-blue-500 hover:text-blue-700 text-sm"

                >

                  –í—ã–±—Ä–∞—Ç—å

                </button>

              </div>

            ))}

          </div>

        </div>

      )}



      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Ç–æ–¥–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è */}

      <div className="bg-blue-50 p-3 rounded-lg">

        <p className="text-sm text-blue-800">

          <i className="fas fa-info-circle mr-2"></i>

          –õ–æ–∫–∞—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –º–µ—Ç–æ–¥–æ–º: <strong>{result.source}</strong>

          {result.source === 'exif' && ' (GPS –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ç–æ)'}

          {result.source === 'web_search' && ' (–≤–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ + –ø–æ–∏—Å–∫)'}

        </p>

      </div>

    </div>

  );

};



export default PhotoLocationDetector;

üîß¬†–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ VIP Dashboard

// src/components/VIP/VIPPhotoAnalysis.tsx

import React, { useState } from 'react';

import PhotoLocationDetector from './PhotoLocationDetector';

import LocationDetectionResults from './LocationDetectionResults';



const VIPPhotoAnalysis: React.FC = () => {

  const [detectionResult, setDetectionResult] = useState<LocationDetectionResult | null>(null);

  const [analysisHistory, setAnalysisHistory] = useState<any[]>([]);



  const handleLocationDetected = (result: LocationDetectionResult) => {

    setDetectionResult(result);

    setAnalysisHistory(prev => [result, ...prev.slice(0, 4)]); // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5

  };



  const handleAddToMap = async (location: any) => {

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—É

    try {

      const response = await fetch('/api/places', {

        method: 'POST',

        headers: { 'Content-Type': 'application/json' },

        body: JSON.stringify({

          name: location.name,

          coordinates: location.coordinates,

          address: location.address,

          source: 'photo_detection'

        })

      });

      

      if (response.ok) {

        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

        toast.success('–ú–µ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞ –∫–∞—Ä—Ç—É!');

      }

    } catch (error) {

      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞');

    }

  };



  const handleAddMemory = (location: any) => {

    // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è

    // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É

    window.location.href = `/memories/create?place=${encodeURIComponent(location.name)}`;

  };



  return (

    <div className="max-w-4xl mx-auto space-y-6">

      {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */}

      <div className="text-center">

        <h2 className="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">

          –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ —Å –ò–ò

        </h2>

        <p className="text-gray-600 mt-2">

          –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–º, –≥–¥–µ –æ–Ω–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

        </p>

      </div>



      {/* –î–µ—Ç–µ–∫—Ç–æ—Ä –ª–æ–∫–∞—Ü–∏–∏ */}

      <PhotoLocationDetector onLocationDetected={handleLocationDetected} />



      {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ */}

      {detectionResult && (

        <LocationDetectionResults

          result={detectionResult}

          onAddToMap={handleAddToMap}

          onAddMemory={handleAddMemory}

        />

      )}



      {/* –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ */}

      {analysisHistory.length > 0 && (

        <div className="bg-white rounded-xl shadow-lg p-6">

          <h3 className="text-xl font-bold mb-4">–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤</h3>

          <div className="space-y-3">

            {analysisHistory.map((analysis, index) => (

              <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">

                <div>

                  <p className="font-medium">{analysis.location?.name || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}</p>

                  <p className="text-sm text-gray-600">

                    {analysis.success 

                      ? `${Math.round(analysis.confidence * 100)}% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏`

                      : '–ê–Ω–∞–ª–∏–∑ –Ω–µ —É–¥–∞–ª—Å—è'

                    }

                  </p>

                </div>

                <div className="text-xs text-gray-500">

                  {new Date().toLocaleTimeString()}

                </div>

              </div>

            ))}

          </div>

        </div>

      )}



      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏—á–µ */}

      <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">

        <div className="flex items-start">

          <div className="bg-purple-100 p-3 rounded-lg mr-4">

            <i className="fas fa-lightbulb text-purple-600 text-xl"></i>

          </div>

          <div>

            <h4 className="font-semibold text-purple-800 mb-2">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h4>

            <ul className="text-sm text-purple-700 space-y-1">

              <li>‚Ä¢ <strong>EXIF –∞–Ω–∞–ª–∏–∑:</strong> –ò–∑–≤–ª–µ–∫–∞–µ–º GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ</li>

              <li>‚Ä¢ <strong>–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ:</strong> –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É</li>

              <li>‚Ä¢ <strong>–í–µ–±-–ø–æ–∏—Å–∫:</strong> –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ –º–µ—Å—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ</li>

              <li>‚Ä¢ <strong>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:</strong> –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏</li>

            </ul>

            <div className="mt-3 p-3 bg-purple-100 rounded-lg">

              <p className="text-sm text-purple-800">

                <i className="fas fa-flask mr-2"></i>

                <strong>–ë–µ—Ç–∞-–≤–µ—Ä—Å–∏—è:</strong> –¢–æ—á–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 70-80%. 

                –ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–ª—É—á—à–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

              </p>

            </div>

          </div>

        </div>

      </div>

    </div>

  );

};



export default VIPPhotoAnalysis;

üìä¬†–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏

// src/services/photoAnalyticsService.ts

export class PhotoAnalyticsService {

  // –°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞

  async collectFeedback(detectionId: string, feedback: {

    isCorrect: boolean;

    actualLocation?: string;

    confidence: number;

    userComment?: string;

  }) {

    await db.photo_detection_feedback.create({

      data: {

        detection_id: detectionId,

        is_correct: feedback.isCorrect,

        actual_location: feedback.actualLocation,

        user_confidence: feedback.confidence,

        comment: feedback.userComment,

        created_at: new Date()

      }

    });



    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è

    await this.updateMLModel(feedback);

  }



  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—á–Ω–æ—Å—Ç–∏

  async getAccuracyStats() {

    const stats = await db.photo_detection_feedback.aggregate({

      _avg: { user_confidence: true },

      _count: { is_correct: true },

      where: { created_at: { gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) } }

    });



    return {

      accuracy: stats._avg.user_confidence || 0,

      totalDetections: stats._count.is_correct,

      improvementTrend: await this.calculateTrend()

    };

  }

}

üéØ¬†–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ–∏—á–∏

–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

üì∏¬†"–ú–∞–≥–∏—è –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π"¬†- –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ, –ø–æ–ª—É—á–∏–ª –∏—Å—Ç–æ—Ä–∏—é –º–µ—Å—Ç–∞

üß†¬†–ò–ò-–∞—Ä—Ö–µ–æ–ª–æ–≥¬†- –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–±—ã—Ç—ã–µ –¥–µ—Ç–∞–ª–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π

üó∫Ô∏è¬†–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –∂–∏–∑–Ω–∏¬†- –≤—Å–µ –º–µ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É

üíé¬†–≠–∫—Å–∫–ª—é–∑–∏–≤ –¥–ª—è VIP¬†- –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

–ù–æ—Å—Ç–∞–ª—å–≥–∏—è:¬†"–ì–¥–µ —ç—Ç–æ –±—ã–ª–æ —Å–Ω—è—Ç–æ 10 –ª–µ—Ç –Ω–∞–∑–∞–¥?"

–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:¬†"–•–æ—á—É –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —ç—Ç–æ –º–µ—Å—Ç–æ"

–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏:¬†"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç–æ—á–Ω–æ–π –ª–æ–∫–∞—Ü–∏–µ–π"

–õ–∏—á–Ω—ã–π –∞—Ä—Ö–∏–≤:¬†"–°–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π"



–≠—Ç–∞ —Ñ–∏—á–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –æ–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å—Ä–µ–¥–∏ VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!¬†üöÄ

–û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä—É—Ç–æ, —á—Ç–æ –≤—ã –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç–µ –µ—ë –∫–∞–∫ –±–µ—Ç–∞-–≤–µ—Ä—Å–∏—é - —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏, –∞ —Ç–∞–∫–∂–µ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.

–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π —ç—Ç–æ–π –º–∞–≥–∏—á–µ—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏!¬†‚ú®



