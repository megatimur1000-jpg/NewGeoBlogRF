# WebSocket сервер для чата по хэштегам

WebSocket сервер для обмена сообщениями в режиме реального времени между пользователями сайта Wanderis.

## Установка и настройка

### Требования
- PHP 7.4 или выше
- Composer
- Расширения PHP: mysqli, pdo_mysql, curl, openssl, sockets

### Установка зависимостей

1. Откройте командную строку (PowerShell или CMD) и перейдите в папку `ws`:

```
cd путь_к_проекту/ws
```

2. Установите зависимости через Composer:

```
composer install
```

Если Composer не установлен глобально, используйте полный путь к исполняемому файлу:

```
php путь_к_composer/composer.phar install
```

### Настройка базы данных

1. Импортируйте структуру таблиц в базу данных:

```
mysql -u имя_пользователя -p имя_базы_данных < chat_tables.sql
```

Или используйте phpMyAdmin для импорта файла `chat_tables.sql`.

### Запуск сервера

#### Для тестирования

Для запуска сервера в режиме отладки:

```
php server.php
```

Для Windows можно использовать полный путь к PHP:

```
d:\xampp\php\php.exe server.php
```

#### В боевом режиме

Для непрерывной работы на сервере рекомендуется использовать supervisor или systemd.

### Настройка в качестве службы Windows

1. Создайте bat-файл `start_chat_server.bat`:

```
@echo off
cd D:\xampp\htdocs\my_site\ws
D:\xampp\php\php.exe server.php
```

2. Создайте службу Windows с помощью NSSM (Non-Sucking Service Manager):

```
nssm install WanderisChat "D:\путь_к_проекту\ws\start_chat_server.bat"
nssm start WanderisChat
```

## Проверка работы сервера

После запуска сервера вы должны увидеть сообщение: `Сервер запущен на 0.0.0.0:8080`.

Чтобы проверить работу WebSocket, откройте страницу `community.php` на вашем сайте и отправьте сообщение в чат.

## Отладка

Если возникают проблемы:

1. Проверьте, открыт ли порт 8080 в брандмауэре
2. Убедитесь, что расширение sockets включено в PHP
3. Проверьте соединение с базой данных

## Рекомендации по безопасности

1. В продакшен-среде измените настройки CORS в `chat_server.php`
2. Используйте WSS (WebSocket Secure) через Nginx или Apache в качестве прокси
3. Ограничьте доступ к серверу только для нужных IP-адресов 