# üìä –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –°–ò–°–¢–ï–ú–´ –ú–û–î–ï–†–ê–¶–ò–ò

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û

### Backend:
1. ‚úÖ **SQL –º–∏–≥—Ä–∞—Ü–∏—è** (`backend/src/migrations/add-moderation-fields.sql`)
   - –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è `status`, `moderation_reason`, `moderated_at`, `moderated_by` –≤–æ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
   - –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

2. ‚úÖ **–ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏** (`backend/src/controllers/moderationController.js`)
   - `getPendingContent` - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É
   - `approveContent` - –æ–¥–æ–±—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
   - `rejectContent` - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç (—Å –ø—Ä–∏—á–∏–Ω–æ–π)
   - `hideContent` - —Å–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
   - `getModerationStats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º

3. ‚úÖ **–†–æ—É—Ç—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏** (`backend/src/routes/moderationRoutes.js`)
   - –í—Å–µ —Ä–æ—É—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã `authenticateToken` –∏ `requireRole(['admin'])`
   - –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

4. ‚úÖ **–°–∫—Ä–∏–ø—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏** (`backend/apply-moderation-migration.js`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

5. ‚úÖ **–†–æ—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ —Å–µ—Ä–≤–µ—Ä—É** (`backend/server.js`)
   - `app.use('/api/moderation', moderationRoutes)`

### Frontend:
1. ‚úÖ **EventsModerationPanel** - –ø–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
2. ‚úÖ **ModerationPanel** - –æ—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –ø–æ–∫–∞)
3. ‚úÖ **PendingEventsStats** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏

---

## ‚ùå –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### Backend:
1. ‚ö†Ô∏è **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∫ –ë–î**
   ```bash
   cd backend
   node apply-moderation-migration.js
   ```

2. ‚ö†Ô∏è **–û–±–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**
   - –ü–æ—Å—Ç—ã: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `status = 'pending'` –¥–ª—è –≥–æ—Å—Ç–µ–π
   - –ú–∞—Ä—à—Ä—É—Ç—ã: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `status = 'pending'` –¥–ª—è –≥–æ—Å—Ç–µ–π
   - –ú–µ—Ç–∫–∏: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `status = 'pending'` –¥–ª—è –≥–æ—Å—Ç–µ–π
   - –ë–ª–æ–≥–∏: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `status = 'pending'` –¥–ª—è –≥–æ—Å—Ç–µ–π

3. ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞**
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Frontend:
1. ‚ùå **–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–Ω–µ–ª–µ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏:**
   - `PostsModerationPanel.tsx`
   - `RoutesModerationPanel.tsx`
   - `MarkersModerationPanel.tsx`
   - `BlogsModerationPanel.tsx`
   - `CommentsModerationPanel.tsx`
   - `ChatsModerationPanel.tsx`

2. ‚ùå **–û–±–Ω–æ–≤–∏—Ç—å ModerationPanel:**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏

3. ‚ùå **–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏:**
   - `moderationService.ts` - –µ–¥–∏–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤
   - –ú–µ—Ç–æ–¥—ã: `getPending`, `approve`, `reject`, `hide`, `getStats`

4. ‚ùå **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## üìã –°–¢–†–£–ö–¢–£–†–ê API

### –ë–∞–∑–æ–≤—ã–π URL: `/api/moderation`

### Endpoints:

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- `GET /api/moderation/stats`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  - –§–æ—Ä–º–∞—Ç: `{ events: {...}, posts: {...}, routes: {...}, ... }`

#### –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:
- `GET /api/moderation/:contentType/pending`
  - `contentType`: `events`, `posts`, `routes`, `markers`, `blogs`, `comments`, `chats`
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`

#### –û–¥–æ–±—Ä–∏—Ç—å:
- `POST /api/moderation/:contentType/:id/approve`
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `status = 'active'`, `is_public = true`

#### –û—Ç–∫–ª–æ–Ω–∏—Ç—å:
- `POST /api/moderation/:contentType/:id/reject`
  - Body: `{ "reason": "–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è" }`
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `status = 'rejected'`, `is_public = false`

#### –°–∫—Ä—ã—Ç—å:
- `POST /api/moderation/:contentType/:id/hide`
  - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `status = 'hidden'`, `is_public = false`

---

## üîß –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:
```bash
cd backend
node apply-moderation-migration.js
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É API:
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∞)
curl -X GET http://localhost:3002/api/moderation/events/pending \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"

# –û–¥–æ–±—Ä–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
curl -X POST http://localhost:3002/api/moderation/events/EVENT_ID/approve \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"

# –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ—Å—Ç
curl -X POST http://localhost:3002/api/moderation/posts/POST_ID/reject \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"reason": "–°–ø–∞–º"}'
```

### 3. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–Ω–µ–ª–µ–π:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EventsModerationPanel.tsx` –∫–∞–∫ —à–∞–±–ª–æ–Ω
- –ó–∞–º–µ–Ω–∏—Ç—å `getPendingEvents` –Ω–∞ `getPendingContent(contentType)`
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥ —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## üìù –ó–ê–ú–ï–¢–ö–ò

- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç —Ä–æ–ª—å `admin`
- –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
- –°—Ç–∞—Ç—É—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –ò—Å—Ç–æ—Ä–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –ø–æ–ª—è `moderated_at` –∏ `moderated_by`

