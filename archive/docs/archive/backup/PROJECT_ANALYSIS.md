# –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∑–∞–≥—Ä—É–∑–∫–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
2. [–ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è (–¥–µ—Å–∫—Ç–æ–ø–Ω–∞—è) –≤–µ—Ä—Å–∏—è](#–±—Ä–∞—É–∑–µ—Ä–Ω–∞—è-–¥–µ—Å–∫—Ç–æ–ø–Ω–∞—è-–≤–µ—Ä—Å–∏—è)
3. [–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è](#–º–æ–±–∏–ª—å–Ω–∞—è-–≤–µ—Ä—Å–∏—è)
4. [–ü—Ä–æ–±–ª–µ–º—ã –∏ –æ—à–∏–±–∫–∏](#–ø—Ä–æ–±–ª–µ–º—ã-–∏-–æ—à–∏–±–∫–∏)
5. [–ü—É—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#–ø—É—Ç–∏-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `main.tsx`
```typescript
ReactDOM.createRoot(document.getElementById('root')!).render(
  <ErrorBoundary>
    <App />
  </ErrorBoundary>
)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞ (message channel)
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É
- ‚úÖ –°—Ç–∏–ª–∏ Leaflet –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π/–¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏

**–•—É–∫ `useIsMobile()`:**
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞: window.innerWidth < 768
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –º–∏–≥–∞–Ω–∏—è
```

**–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `App.tsx`:**
- `GuestLayout` / `ProtectedLayout` ‚Üí –ø—Ä–æ–≤–µ—Ä—è—é—Ç `useIsMobile()`
- –ï—Å–ª–∏ –º–æ–±–∏–ª—å–Ω–∞—è ‚Üí `MobileLayout`
- –ï—Å–ª–∏ –¥–µ—Å–∫—Ç–æ–ø ‚Üí `MainLayout`

---

## üñ•Ô∏è –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è (–¥–µ—Å–∫—Ç–æ–ø–Ω–∞—è) –≤–µ—Ä—Å–∏—è

### –ü—É—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã:

```
App.tsx
  ‚îî‚îÄ> Route "/map" 
      ‚îî‚îÄ> ConditionalPage
          ‚îî‚îÄ> desktop={PersistentMaps} (lazy)
              ‚îî‚îÄ> LazyMap (lazy)
                  ‚îî‚îÄ> MapPage (pages/Map.tsx)
                      ‚îî‚îÄ> MapComponent (components/Map/Map.tsx)
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. **PersistentMaps.tsx**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É `/map` –∏ `/planner`
- **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `visibility: hidden` –≤–º–µ—Å—Ç–æ `display: none`
- **–ó–∞–≥—Ä—É–∑–∫–∞:** Lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ

#### 2. **MapPage.tsx** (pages/Map.tsx)
- **–ò–º–ø–æ—Ä—Ç:** `import MapComponent from '../components/Map/Map'` (–ù–ï lazy!)
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–∫ —á–µ—Ä–µ–∑ `markerService.getAllMarkers()`
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–æ–∫
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª—è–º–∏ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏–∑–±—Ä–∞–Ω–Ω–æ–µ)
  - –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 3. **Map.tsx** (components/Map/Map.tsx)
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
  ```typescript
  useEffect(() => {
    // 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π Leaflet
    await loadLeafletStyles();
    
    // 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç Leaflet
    const leafletModule = await import('leaflet');
    L = (leafletModule as any).default || leafletModule;
    
    // 3. –ò–º–ø–æ—Ä—Ç markercluster
    await import('leaflet.markercluster');
    
    // 4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
    const map = L.map('map', { center, zoom, ... });
  }, []);
  ```

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚úÖ –ü—Ä—è–º–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `L.map('map', ...)`
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `L` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Leaflet
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π

---

## üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

### –ü—É—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã:

```
App.tsx
  ‚îî‚îÄ> Route "/map"
      ‚îî‚îÄ> ConditionalPage
          ‚îî‚îÄ> mobile={MobileMapPage} (lazy)
              ‚îî‚îÄ> pages/Mobile/MapPage.tsx
                  ‚îî‚îÄ> MapComponent (lazy!)
                      ‚îî‚îÄ> components/Map/Map.tsx
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### 1. **MobileMapPage.tsx**
```typescript
// ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –î–≤–æ–π–Ω–∞—è lazy –∑–∞–≥—Ä—É–∑–∫–∞!
const MapComponent = lazy(() => import('../../components/Map/Map'));

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
<Suspense fallback={...}>
  <MapComponent {...props} />
</Suspense>
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- üî¥ **–î–≤–æ–π–Ω–∞—è lazy –∑–∞–≥—Ä—É–∑–∫–∞:** `ConditionalPage` —É–∂–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ `Suspense`, –∞ –≤–Ω—É—Ç—Ä–∏ –µ—â–µ –æ–¥–∏–Ω `Suspense`
- üî¥ **Lazy –∏–º–ø–æ—Ä—Ç MapComponent:** –í –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏ `MapComponent` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
- üî¥ **–†–∞–∑–Ω—ã–µ –ø—É—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏:** –ú–æ–±–∏–ª—å–Ω–∞—è –∏ –¥–µ—Å–∫—Ç–æ–ø–Ω–∞—è –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

#### 2. **Map.tsx** (—Ç–æ—Ç –∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ lazy, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∏ –æ—à–∏–±–∫–∏

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –∫–∞—Ä—Ç—ã**

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ "map.error.initialization"
- –ö–∞—Ä—Ç–∞ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- –ö–Ω–æ–ø–∫–∞ "map.error.retry" –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–î–≤–æ–π–Ω–∞—è lazy –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏:**
   - `ConditionalPage` ‚Üí `Suspense` ‚Üí `MobileMapPage` (lazy)
   - `MobileMapPage` ‚Üí `Suspense` ‚Üí `MapComponent` (lazy)
   - –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏ –∑–∞–≥—Ä—É–∑–∫–∏

2. **–†–∞–∑–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∏–º–ø–æ—Ä—Ç–∞:**
   - –î–µ—Å–∫—Ç–æ–ø: `import MapComponent from '../components/Map/Map'` (–ø—Ä—è–º–æ–π)
   - –ú–æ–±–∏–ª—å–Ω–∞—è: `lazy(() => import('../../components/Map/Map'))` (lazy)

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ DOM:**
   - `L.map('map', ...)` —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã —ç–ª–µ–º–µ–Ω—Ç `#map` —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –≤ DOM
   - –ü—Ä–∏ lazy –∑–∞–≥—Ä—É–∑–∫–µ —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π Leaflet**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –°—Ç–∏–ª–∏ Leaflet –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç `leaflet` –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `L` –º–æ–∂–µ—Ç –±—ã—Ç—å `null` –∏–ª–∏ `undefined`

### 3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫**

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
catch (err) {
  setError(t('map.error.initialization'));
  setIsLoading(false);
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –û—à–∏–±–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–∞ –º–æ–≥—É—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏
- –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –ö–Ω–æ–ø–∫–∞ retry –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîß –ü—É—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ MapComponent**

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∏–º–ø–æ—Ä—Ç–∞ –≤ –º–æ–±–∏–ª—å–Ω–æ–π –∏ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// pages/Mobile/MapPage.tsx
// ‚ùå –£–ë–†–ê–¢–¨ lazy:
// const MapComponent = lazy(() => import('../../components/Map/Map'));

// ‚úÖ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç:
import MapComponent from '../../components/Map/Map';

// –£–±—Ä–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Suspense, —Ç–∞–∫ –∫–∞–∫ ConditionalPage —É–∂–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç
<MapComponent {...props} />
```

### 2. **–£–ª—É—á—à–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã**

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠–ª–µ–º–µ–Ω—Ç `#map` –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø—Ä–∏ lazy –∑–∞–≥—Ä—É–∑–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í Map.tsx, –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞:
useEffect(() => {
  const initMap = async () => {
    // –ñ–¥–µ–º, –ø–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç –ø–æ—è–≤–∏—Ç—Å—è –≤ DOM
    let attempts = 0;
    while (!document.getElementById('map') && attempts < 50) {
      await new Promise(resolve => setTimeout(resolve, 100));
      attempts++;
    }
    
    const mapElement = document.getElementById('map');
    if (!mapElement) {
      throw new Error('–≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM');
    }
    
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...
  };
}, []);
```

### 3. **–£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
catch (err) {
  console.error('–î–µ—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', {
    error: err,
    message: err instanceof Error ? err.message : String(err),
    stack: err instanceof Error ? err.stack : undefined,
    L: typeof L,
    mapElement: !!document.getElementById('map')
  });
  
  setError(t('map.error.initialization') || '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã');
  setIsLoading(false);
}
```

### 4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–∞**

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const [retryCount, setRetryCount] = useState(0);

const handleRetry = () => {
  setRetryCount(prev => prev + 1);
  setError(null);
  setIsLoading(true);
  // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
};

// –í useEffect –¥–æ–±–∞–≤–∏—Ç—å retryCount –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
useEffect(() => {
  // ... –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
}, [retryCount]);
```

### 5. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∏–ª–µ–π**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∏–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
await loadLeafletStyles();

// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
const stylesLoaded = document.querySelector('link[data-leaflet-styles]');
if (!stylesLoaded) {
  console.warn('–°—Ç–∏–ª–∏ Leaflet –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –æ–∂–∏–¥–∞–µ–º...');
  await new Promise(resolve => setTimeout(resolve, 500));
}
```

### 6. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏–∑-–∑–∞ –¥–≤–æ–π–Ω–æ–π lazy –∑–∞–≥—Ä—É–∑–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞—Ç—å lazy –∏–∑ `MobileMapPage.tsx` –¥–ª—è `MapComponent`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –∫–∞–∫ –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏
- –û—Å—Ç–∞–≤–∏—Ç—å lazy —Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ `ConditionalPage`

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ê—Å–ø–µ–∫—Ç | –î–µ—Å–∫—Ç–æ–ø | –ú–æ–±–∏–ª—å–Ω–∞—è | –ü—Ä–æ–±–ª–µ–º–∞ |
|--------|---------|-----------|----------|
| **–ò–º–ø–æ—Ä—Ç MapComponent** | –ü—Ä—è–º–æ–π | Lazy | ‚ùå –†–∞–∑–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã |
| **Suspense –æ–±–µ—Ä—Ç–∫–∏** | 1 (ConditionalPage) | 2 (ConditionalPage + –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) | ‚ùå –î–≤–æ–π–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞ |
| **–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∏–ª–µ–π** | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è | ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–æ |
| **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã** | –ü—Ä—è–º–∞—è | –ü—Ä—è–º–∞—è | ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–æ |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | –ë–∞–∑–æ–≤–∞—è | –ë–∞–∑–æ–≤–∞—è | ‚ö†Ô∏è –ù—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (–∫—Ä–∏—Ç–∏—á–Ω–æ):
1. ‚úÖ **–£–±—Ä–∞—Ç—å lazy –∏–º–ø–æ—Ä—Ç `MapComponent` –∏–∑ `MobileMapPage.tsx`**
   - –ó–∞–º–µ–Ω–µ–Ω –Ω–∞ –ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç: `import MapComponent from '../../components/Map/Map'`
   - –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —Å –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π

2. ‚úÖ **–£–±—Ä–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `Suspense` –∏–∑ `MobileMapPage.tsx`**
   - –£–¥–∞–ª–µ–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `Suspense`, —Ç–∞–∫ –∫–∞–∫ `ConditionalPage` —É–∂–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≤ `Suspense`
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –¥–≤–æ–π–Ω–∞—è lazy –∑–∞–≥—Ä—É–∑–∫–∞

3. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ `#map` –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ DOM (–¥–æ 5 —Å–µ–∫—É–Ω–¥)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∏–ª–µ–π Leaflet
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

4. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ:
     - –¢–∏–ø–µ –æ—à–∏–±–∫–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏–∏
     - Stack trace
     - –°–æ—Å—Ç–æ—è–Ω–∏–∏ L (Leaflet)
     - –ù–∞–ª–∏—á–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–∞—Ä—Ç—ã
     - –ó–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∏–ª–µ–π

### üîÑ –í –ü–†–û–¶–ï–°–°–ï (–≤–∞–∂–Ω–æ):
5. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è)
6. ‚úÖ –£–ª—É—á—à–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∏–ª–µ–π Leaflet (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞)

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):
7. ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∏ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–π
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
9. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞

---

## üìù –†–µ–∑—é–º–µ

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–æ–π–Ω—É—é lazy –∑–∞–≥—Ä—É–∑–∫—É –∏ lazy –∏–º–ø–æ—Ä—Ç `MapComponent`, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏ –∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ DOM.

**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç `MapComponent` (–ø—Ä—è–º–æ–π –∏–º–ø–æ—Ä—Ç, –∫–∞–∫ –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏) –∏ —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ `Suspense` –æ–±–µ—Ä—Ç–∫–∏.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π.

