# üîç –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ñ–∞—Å–∞–¥–∞ –∫–∞—Ä—Ç—ã

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –î–í–û–ô–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ö–û–ù–§–õ–ò–ö–¢ –ì–†–£–ü–ü –ö–õ–ê–°–¢–ï–†–û–í

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –î–≤–µ –≥—Ä—É–ø–ø—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤

**–ì–¥–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:**

1. **–í leafletAdapter.ts (—Å—Ç—Ä–æ–∫–∞ 44):**
```typescript
markerClusterGroup = (L as any).markerClusterGroup();
if (markerClusterGroup && markerClusterGroup.addTo) markerClusterGroup.addTo(map);
```

2. **–í Map.tsx (—Å—Ç—Ä–æ–∫–∞ 793):**
```typescript
const markerClusterGroup = (L as any).markerClusterGroup({...});
// ...
markerClusterGroup.addLayer(leafletMarker);
// ...
markerClusterGroup.addTo(mapRef.current);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–∞—Å–∞–¥ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ—é –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- Map.tsx —Å–æ–∑–¥–∞–µ—Ç –°–í–û–Æ –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
- –ú–∞—Ä–∫–µ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É –∏–∑ Map.tsx, –Ω–æ —Ñ–∞—Å–∞–¥ —É–∂–µ —Å–æ–∑–¥–∞–ª —Å–≤–æ—é –≥—Ä—É–ø–ø—É
- –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–º–µ—à–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞—Å–∞–¥–∞ –∏ –ø—Ä—è–º–æ–≥–æ Leaflet

**–¢–µ–∫—É—â–∏–π flow:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥** (Map.tsx:458):
   - `mapFacade.initializeMap()` ‚Üí `leafletAdapter.initializeLeaflet()`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ `L.map()`
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –≥—Ä—É–ø–ø–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
   - –ù–û tileLayer –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ leafletAdapter.ts:37)

2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥** (Map.tsx:461):
   - `mapFacade.getMap()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ä—Ç—É
   - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è tileLayer –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Leaflet

3. **–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –ù–ê–ü–†–Ø–ú–£–Æ —á–µ—Ä–µ–∑ Leaflet** (Map.tsx:808-989):
   - –ú–∞—Ä–∫–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `L.marker()`
   - –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –°–í–û–Æ –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (–Ω–µ —Ç—É, —á—Ç–æ —Å–æ–∑–¥–∞–ª —Ñ–∞—Å–∞–¥)
   - –ü–æ–ø–∞–ø—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ –º–∞—Ä–∫–µ—Ä–∞–º

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§–∞—Å–∞–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É –∏ —Å–æ–∑–¥–∞–µ—Ç –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –ù–æ –º–∞—Ä–∫–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ù–ï —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥, –∞ –Ω–∞–ø—Ä—è–º—É—é
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –î–í–ï —Ä–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –ø–æ–ø–∞–ø–∞–º–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ–ø–∞–ø—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ (Map.tsx:879):**
```typescript
leafletMarker.on('popupopen', (e: L.PopupEvent) => {
  // –ü–æ–ø–∞–ø —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ popupopen
  // –ù–æ –∫–∞—Ä—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞
  const popupContentDiv = popupElement.querySelector('.leaflet-popup-content');
  // ...
  root.render(<MarkerPopup ... />);
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°–æ–±—ã—Ç–∏–µ `popupopen` –º–æ–∂–µ—Ç —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∫–∞—Ä—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- DOM —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ø–∞–ø–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≥–æ—Ç–æ–≤—ã
- React root –º–æ–∂–µ—Ç –Ω–µ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîß –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞—Å–∞–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –£–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ Map.tsx
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏–∑ —Ñ–∞—Å–∞–¥–∞
3. –î–æ–±–∞–≤–ª—è—Ç—å –º–∞—Ä–∫–µ—Ä—ã —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
4. –ò–ª–∏ –ø–æ–ª—É—á–∞—Ç—å –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏–∑ —Ñ–∞—Å–∞–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å —Ñ–∞—Å–∞–¥ –¥–ª—è Map.tsx

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `L.map()`
2. –°–æ–∑–¥–∞–≤–∞—Ç—å –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –Ω–∞–ø—Ä—è–º—É—é
3. –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞—Å–∞–¥ –≤–æ–æ–±—â–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–¢–ï–ö–£–©–ò–ô, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞—Å–∞–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
2. –ü–æ–ª—É—á–∞—Ç—å –∫–∞—Ä—Ç—É —á–µ—Ä–µ–∑ `getMap()`
3. –ü–æ–ª—É—á–∞—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –û–î–ù–£ –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
5. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ø–∞–ø–æ–≤

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–û–ï –†–ï–®–ï–ù–ò–ï

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç 3** —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏:

1. **–ü–æ–ª—É—á–∞—Ç—å –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –∏–∑ —Ñ–∞—Å–∞–¥–∞** (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ) –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –û–î–ù–£ –≥—Ä—É–ø–ø—É
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ø–∞–ø–æ–≤
3. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ tileLayer –¥–æ–±–∞–≤–ª–µ–Ω** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –º–∞—Ä–∫–µ—Ä–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –≥—Ä—É–ø–ø—É –∫–ª–∞—Å—Ç–µ—Ä–æ–≤** –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤

